# АВАЮССТРОЙ — система управления персоналом и расписанием

Внутренний веб‑сервис для работы с сотрудниками, объектами, назначениями и табелем.
Проект рассчитан на использование внутри компании и хранит данные в локальных JSON‑файлах.

---

## Что умеет сервис

- Аутентификация пользователей (вход/выход).
- Разделение ролей:
  - `admin` — управление пользователями;
  - `user` — работа с собственным профилем и назначениями.
- Работники:
  - список, фильтрация, карточка работника, редактирование;
  - история назначений за выбранный месяц.
- Объекты:
  - CRUD, статусы, ответственный пользователь.
- Расписание:
  - назначения по дням и сменам;
  - редактирование и удаление;
  - пометки/комментарии.
- Табель:
  - матрица часов по сотрудникам и дням месяца.

---

## Технологии

- **Backend:** Go 1.23+, Gin.
- **Хранение данных:** JSON (`storage/*.json`).
- **UI:** серверный рендеринг HTML + CSS (без SPA).

---

## Структура проекта

- `cmd/server/main.go` — точка входа, загрузка данных, запуск HTTP‑сервера.
- `internal/router` — маршрутизация.
- `internal/api` — HTTP‑обработчики страниц/действий.
- `internal/storage` — слой чтения/записи JSON, валидации и нормализации.
- `internal/models` — модели данных.
- `web/static` — CSS и статические ресурсы (логотип/иконки).
- `storage/*.json` — рабочие данные сервиса.

---

## Быстрый старт

### Требования

- Go (рекомендуется версия из `go.mod`: 1.23+).

### Запуск

```bash
go run ./cmd/server
```

По умолчанию сервис поднимается на `http://localhost:8099`.

### Проверка

```bash
go test ./...
```

---

## Роли и доступ

- Все защищённые разделы находятся под middleware `AuthRequired`.
- Раздел пользователей (`/users*`) доступен только через `AdminRequired`.
- Для не‑админов доступ к операциям с назначениями ограничен привязанным работником.

---

## Важное: ограничения безопасности (если открывать в интернет)

> Сейчас проект ориентирован на **внутренний контур**. Перед публичным размещением требуется hardening.

### Критичные риски в текущей реализации

1. **Пароли хранятся в открытом виде** (plaintext) в JSON и сравниваются как есть.
2. **Сессионная cookie не подписана и хранит только `user.ID`**, что потенциально упрощает подделку сессии при компрометации cookie.
3. **Нет принудительных параметров cookie для внешнего продакшена**:
   - не выставляются `Secure` и `SameSite`;
   - нет привязки к HTTPS‑режиму.
4. **Нет CSRF‑защиты** на POST‑формах.
5. **Нет rate limiting / brute-force защиты** на `/login`.
6. **Файловое хранилище JSON** не подходит для публичной нагрузки:
   - риск повреждения/конфликтов данных;
   - отсутствуют транзакции, аудит и централизованные политики доступа.
7. **Нет production‑reverse‑proxy hardening** (HSTS, ограничение заголовков, WAF, IP allowlist и т.д.).

### Что сделать перед публикацией в интернет

- Перейти на хэширование паролей (`bcrypt`/`argon2id`) + политика сложности паролей.
- Перевести сессии на подписанные/шифрованные токены или серверное session storage.
- Включить HTTPS и cookie‑флаги: `Secure`, `HttpOnly`, `SameSite`.
- Добавить CSRF‑токены для всех mutating‑форм.
- Добавить ограничение попыток входа (rate limit + lockout + audit).
- Перенести данные из JSON в СУБД (PostgreSQL) с миграциями/бэкапами.
- Добавить централизованный security‑логинг и мониторинг.

---

## Текущий статус

Проект функционален как внутренний сервис управления персоналом/расписанием.
Для публичного интернета требуется отдельный этап усиления безопасности.
