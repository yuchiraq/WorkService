<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Добавить работника</title>
    <link rel="stylesheet" href="/static/css/styles.css">
</head>
<body>
    {{ template "navigation.html" . }}

    <div class="content">
        <div class="container">
            <h1>Добавить работника</h1>
            <form id="add-worker-form">
                <!-- Required Fields -->
                <div class="form-group">
                    <label for="name">Имя</label>
                    <input type="text" id="name" name="name" required>
                </div>
                <div class="form-group">
                    <label for="position">Должность</label>
                    <input type="text" id="position" name="position" required>
                </div>
                <div class="form-group">
                    <label for="status">Статус</label>
                    <select id="status" name="status">
                        <option value="active">Active</option>
                        <option value="dismissed">Dismissed</option>
                    </select>
                </div>

                <!-- Optional Fields -->
                <div class="form-group">
                    <label for="phone">Телефон (необязательно)</label>
                    <input type="tel" id="phone" name="phone">
                </div>
                <div class="form-group">
                    <label for="hourlyRate">Почасовая ставка (необязательно)</label>
                    <input type="number" id="hourlyRate" name="hourlyRate" step="0.01">
                </div>
                <div class="form-group">
                    <label for="birthDate">Дата рождения (необязательно)</label>
                    <input type="date" id="birthDate" name="birthDate">
                </div>

                <button type="submit" class="btn">Добавить работника</button>
            </form>
        </div>
    </div>

    <script>
        document.getElementById('add-worker-form').addEventListener('submit', function(event) {
            event.preventDefault();

            const formData = new FormData(this);
            const data = {
                name: formData.get('name'),
                position: formData.get('position'),
                status: formData.get('status'),
            };

            // Only include optional fields if they have a value
            const phone = formData.get('phone');
            if (phone) {
                data.phone = phone;
            }

            const hourlyRate = formData.get('hourlyRate');
            if (hourlyRate) {
                // Ensure it's a number
                data.hourlyRate = parseFloat(hourlyRate);
            }

            const birthDate = formData.get('birthDate');
            if (birthDate) {
                data.birthDate = birthDate;
            }

            fetch('/api/workers', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
            .then(async response => {
                if (response.ok) {
                    window.location.href = '/workers';
                } else {
                    const error = await response.json();
                    alert('Не удалось добавить работника: ' + (error.error || 'Unknown error'));
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Произошла ошибка сети.');
            });
        });
    </script>
</body>
</html>
