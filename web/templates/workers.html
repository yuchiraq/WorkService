{{define "content"}}
<div class="container">
    <div style="display: flex; justify-content: space-between; align-items: center;">
        <h1>Список работников</h1>
        <a href="/workers/new" class="btn btn-primary">Добавить работника</a>
    </div>

    <table id="workers-table">
        <thead>
            <tr>
                <th>Имя</th>
                <th>Должность</th>
                <th>Дата приема</th>
                <th>Статус</th>
                <th>Действия</th>
            </tr>
        </thead>
        <tbody>
            <!-- Worker data will be dynamically inserted here -->
        </tbody>
    </table>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        fetch('/api/workers')
            .then(response => response.json())
            .then(data => {
                const tbody = document.querySelector('#workers-table tbody');
                tbody.innerHTML = ''; // Clear existing rows

                if (data && data.length) {
                    data.forEach(worker => {
                        const row = `
                            <tr>
                                <td>${worker.name}</td>
                                <td>${worker.role}</td>
                                <td>${new Date(worker.startDate).toLocaleDateString()}</td>
                                <td>
                                    <span class="status-badge ${worker.status === 'active' ? 'status-active' : 'status-dismissed'}">
                                        ${worker.status}
                                    </span>
                                </td>
                                <td>
                                    <button class="btn btn-danger" onclick="deleteWorker('${worker.ID}')">Удалить</button>
                                </td>
                            </tr>
                        `;
                        tbody.innerHTML += row;
                    });
                } else {
                    tbody.innerHTML = '<tr><td colspan="5" style="text-align: center;">Нет данных о работниках</td></tr>';
                }
            });
    });

    function deleteWorker(id) {
        if (!confirm('Вы уверены, что хотите удалить этого работника?')) {
            return;
        }

        fetch(`/api/workers/${id}`, {
            method: 'DELETE',
        })
        .then(response => {
            if (response.ok) {
                // Refresh the page to show the updated list
                location.reload();
            } else {
                // Handle error
                alert('Ошибка при удалении работника.');
            }
        });
    }
</script>
{{end}}
